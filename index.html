<!DOCTYPE html>
<html lang="es">
    <head>
        <script>
            var version = "1.0.1"
        </script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tokydia</title>
        <link rel="shortcut icon" href="Icon.png" type="image/x-icon">
        <style>
            @font-face {
                font-family: 'Lexend';
                src: url('Lexend.ttf') format('truetype');
                font-weight: normal;
                font-style: normal;
            }

            * {
                margin: 0;
                font-family: 'Lexend';
            }

            body{
                background-color: rgba(0,0,0,0.25);
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .separator {
                width: 100%;
                height: 1px;
                background-color: rgba(8,8,64,1);
                margin: 8px 0px;
            }
            #viewport {
                position: fixed;
                top: 0px;
                left: 0px;
                padding: 8px;
                background-color: black;
                color: white;
                z-index: 999;
                width: 100%;
                text-align: center;
            }
            header {
                background-color: rgba(8,8,64,1);
                height: 69px;
                display: flex;
                width: 100%;
                align-items: center;
                max-width: 1280px;
                padding: 0px calc((100% - 1280px) / 2);
                overflow: hidden;
            }
            header #pageName {
                color: white;
                font-size: 32px;
                padding: 16px;
                border: 0px;
                background: none;
                font-weight: bold;
            }
            header .buttons {
                width: 100%;
                padding: 16px;
                display: flex;
                align-items: self-end;
                justify-content: flex-end;
            }
            header .buttons .button{
                height: 37px;
                color: rgba(255, 255, 255, 0.75);
                font-size: 16px;
                padding: 8px;
                border: 0px;
                background: none;
                font-weight: bold;
            }
            header .buttons .button:hover{
                background-color: rgba(255,255,255,0.2);
                border-radius: 4px;
            }
            #main, #anime, #episode{
                width: calc(100% - 16px);
                max-width: 1280px;
                border-radius: 8px;
                display: block;
                padding: 8px 0px;
            }
            #main {
                
            }
            #main h1 {
                padding: 0px 8px;
            }
            #main .listHeader {
                display: flex;
                justify-content: space-between;
                height: 32px;
                width: calc(100% - 8px);
            }
            #main .listHeader h1{
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }
            #main .listHeader button{
                width: 32px;
                height: 32px;
                border-radius: 4px;
                border: 1px solid black;
            }
            #main .list {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                width: 100%;
                justify-content: center;
            }
            #main .list .item {
                border-radius: 4px;
                position: relative;
                width: calc(100% / 6 - 16px);
                margin: 8px;
                overflow: hidden;
                transition: 0.25s;
            }
            @media screen and (max-width: calc(788px + 1px)) {
                #main .list .item {
                    width: calc(100% / 4 - 16px);
                }
            }
            @media screen and (max-width: calc(393px + 1px)) {
                #main .list .item {
                    width: calc(100% / 2 - 16px);
                }
            }

            #main .list .item .banner {
                width: 100%;
                border-radius: 4px;
                margin-bottom: -4px;
                transition: 0.25s;
            }
            #main .list .item .type {
                background-color: rgba(0,0,128,1);
                display: block;
                border-radius: 4px 0px 8px 0px;
                position: absolute;
                padding: 4px 8px;
                font-weight: bold;
                top: 0px;
                color: white;
                font-size: 12px;
            }
            #main .list .item .name {
                background: linear-gradient(0deg, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
                color: rgba(255, 255, 255, 1);
                position: absolute;
                border-radius: 0px 0px 4px 4px;
                padding: 8px;
                text-overflow: ellipsis;
                white-space: nowrap;
                overflow: hidden;
                bottom: 0px;
                width: calc(100% - 16px);
                transform: scale(0) translateY(100%);
                transition: 0.25s;
                font-weight: bold;
            }
            #main .list .item:hover {
                box-shadow: 0px 0px 32px rgba(0,0,128,1);
            }
            #main .list .item:hover .banner {
                transform: scale(1.25);
            }
            #main .list .item:hover .name {
                transform: scale(1);
            }
            
            #anime {

                #animeInfo{
                    padding: 8px;
                    display: flex;
                    flex-direction: row;
                    flex-wrap: wrap;
                    gap: 8px;
                    width: calc(100% - 16px);
                    div{
                        width: calc(100% - 362px);
                        max-width: 100%;
                    }
                    #animeImage {
                        width: calc(256px - 8px);
                        max-width: calc(100% - 8px);
                        height: fit-content;
                        padding: 8px;
                    }
                    #animeName {
                    }
                    #animeType {
                    }
                    #animeSinopsis {
                    }
                }
            }

            #episode {

                #episodeHeader{
                    display: flex;
                    justify-content: space-between;
                    flex-direction: row;
                    h1 {
                        overflow: hidden;
                        text-overflow: ellipsis;
                        overflow: hidden;
                        white-space: nowrap;
                    }
                    select {
                        padding: 8px;
                        border-radius: 4px;
                    }
                }
                #episodeUrl {
                    width: 100%;
                    height: calc(100vh - 69px - 36px - 17px - 16px);
                    border-radius: 4px;
                }
            }

        </style>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>
    <body>
        <h1 id="viewport"></h1>
        <header>
            <button id="pageName"   onclick="window.location.href = './'">TOKYDIA</button>
            <div class="buttons">
                <button class="button" onclick="window.location.href = './'">Inicio</button>
                <button class="button" onclick="window.location.href = './?directory'">Directorio</button>
            </div>
        </header>
          
        <section id="main">
            <h1>No olvides activar las notificaciones</h1>

            <div class="listHeader">
                <h1>Ultimos episodios</h1>
                <button id="hiddenLastEpisode"                        onclick="hideLastEpisode()">-</button>
                <button id="showLastEpisode"   style="display: none;" onclick="showLastEpisode()">+</button>
            </div>
            <div id="lastEpisode" class="list"></div>
            
            <div class="listHeader">
                <h1>Ultimos animes agregados</h1>
                <button id="hiddenLastAnimes"                        onclick="hideLastAnime()">-</button>
                <button id="showLastAnimes"   style="display: none;" onclick="showLastAnime()">+</button>
            </div>
            <div id="lastAnimes"  class="list"></div>
            
            <div class="listHeader">
                <h1>Ultimas peliculas agregadas</h1>
                <button id="hiddenLastFilms"                        onclick="document.getElementById('showLastFilms').style.display = ''; document.getElementById('hiddenLastFilms').style.display = 'none'; document.getElementById('lastFilms').style.display = 'none'">-</button>
                <button id="showLastFilms"   style="display: none;" onclick="document.getElementById('showLastFilms').style.display = 'none'; document.getElementById('hiddenLastFilms').style.display = ''; document.getElementById('lastFilms').style.display = ''">+</button>
            </div>
            <div id="lastFilms"   class="list"></div>
            
            <div class="listHeader">
                <h1>Animes finalizados</h1>
                <button id="hiddenFinishedAnimes"                        onclick="document.getElementById('showFinishedAnimes').style.display = ''; document.getElementById('hiddenFinishedAnimes').style.display = 'none'; document.getElementById('finishedAnimes').style.display = 'none'">-</button>
                <button id="showFinishedAnimes"   style="display: none;" onclick="document.getElementById('showFinishedAnimes').style.display = 'none'; document.getElementById('hiddenFinishedAnimes').style.display = ''; document.getElementById('finishedAnimes').style.display = ''">+</button>
            </div>
            <div id="finishedAnimes"  class="list"></div>
            <script>
                function showLastEpisode() {
                    document.getElementById('showLastEpisode').style.display = 'none';
                    document.getElementById('hiddenLastEpisode').style.display = '';
                    document.getElementById('lastEpisode').style.display = '';
                    localStorage.setItem('lastEpisodeDisplay', '');
                }
                function hideLastEpisode() {
                    document.getElementById('showLastEpisode').style.display = '';
                    document.getElementById('hiddenLastEpisode').style.display = 'none';
                    document.getElementById('lastEpisode').style.display = 'none';
                    localStorage.setItem('lastEpisodeDisplay', 'none');
                }
                function showLastAnime() {
                    document.getElementById('showLastAnime').style.display = 'none';
                    document.getElementById('hiddenLastAnime').style.display = '';
                    document.getElementById('lastAnime').style.display = '';
                    localStorage.setItem('lastAnimeDisplay', '');
                }
                function hideLastAnime() {
                    document.getElementById('showLastAnime').style.display = '';
                    document.getElementById('hiddenLastAnime').style.display = 'none';
                    document.getElementById('lastAnime').style.display = 'none';
                    localStorage.setItem('lastAnimeDisplay', 'none');
                }
                document.addEventListener('DOMContentLoaded', function () {
                    var lastEpisodeDisplay = localStorage.getItem('lastEpisodeDisplay');
                    if (lastEpisodeDisplay === 'none') {
                        hideLastEpisode();
                    } else {
                        showLastEpisode();
                    }
                    var lastAnimesDisplay = localStorage.getItem('lastAnimeDisplay');
                    if (lastAnimesDisplay === 'none') {
                        hideLastAnime();
                    } else {
                        showLastAnime();
                    }
                });
            </script>
        </section>
        <section id="anime">
            <div id="animeInfo">
                <img id="animeImage" src="">
                <div>
                    <h1 id="animeName"></h1>
                    <h1 id="animeType"></h1>
                    <p id="animeSinopsis"></p>
                </div>
            </div>
            <div class="separator"></div>
            <div id="animeEpisodes"></div>
        </section>
        <section id="episode">
            <div id="episodeHeader"><h1><a id="animeTitle"></a><span id="animeEpisode"></span></h1><select id="selectEpisodeUrl" onchange="document.getElementById('episodeUrl').src = this.value"></select></div>
            <div class="separator"></div>
            <iframe id="episodeUrl" src="" frameborder="0" allowfullscreen></iframe>
        </section>
        <script>
            window.addEventListener('resize', function() {
                var viewportWidth = window.innerWidth || document.documentElement.clientWidth;
                var viewportHeight = window.innerHeight || document.documentElement.clientHeight;

                document.getElementById("viewport").innerText = 'v' + version + ' ' + viewportWidth + ' x ' + viewportHeight;
            });

            // Para mostrar la alerta inicialmente
            window.dispatchEvent(new Event('resize'));
        </script>
        <script>
            // Funci칩n para obtener par치metros de la URL
            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }

            // Verificar si el par치metro 'anime' est치 presente en la URL
            var parametroAnime = getParameterByName('anime');
            var parametroEpisode = getParameterByName('episode');

            if (parametroAnime && parametroEpisode) {
                document.getElementById('main').remove();
                document.getElementById('anime').remove();
                document.getElementById('episode');
                $(document).ready(function() {
                    $.getJSON('database.json', function(data) {
                        var anime = data.animes[parametroAnime];
                        let loop = 1;
                        anime.episodeUrls[parametroEpisode-1].forEach(url => {
                            document.getElementById("selectEpisodeUrl").innerHTML += `<option value="${url}">Option ${loop++}</option>`
                        });
                        document.getElementById('episodeUrl').src = anime.episodeUrls[parametroEpisode-1][0];
                        document.getElementById('animeTitle').innerText = `${anime.name}`;
                        document.getElementById('animeTitle').href = `?anime=${parametroAnime}`;
                        if(anime.type == "Anime") { document.getElementById('animeEpisode').innerText = ` - Episodio  ${parametroEpisode}`; }
                        if(anime.type == "Film") { document.getElementById('animeEpisode').innerText = ``; }
                    });
                });
            } else if (parametroEpisode) {
                window.location.href = '.';
            } else if (parametroAnime){
                document.getElementById('main').remove();
                document.getElementById('anime');
                document.getElementById('episode').remove();
                $(document).ready(function() {
                    $.getJSON('database.json', function(data) {
                        var animes = data.animes;
                        document.getElementById('animeName').innerText = animes[parametroAnime].name;
                        document.getElementById('animeType').innerText = animes[parametroAnime].type;
                        document.getElementById('animeSinopsis').innerText = animes[parametroAnime].sinopsis;
                        document.getElementById('animeImage').src = `images/${parametroAnime}_VerticalBanner.png`;
                        for (let episode = 0; episode < animes[parametroAnime].episodes; episode++) {
                            document.getElementById('animeEpisodes').innerHTML += `<a href="?anime=${parametroAnime}&episode=${episode+1}">Episodio ${episode+1}</li>`; 
                        }
                    });
                });
            } else {
                document.getElementById('main');
                document.getElementById('anime').remove();
                document.getElementById('episode').remove();
                $(document).ready(function() {
                    $.getJSON('database.json', function(data) {
                        var animes = data.animes;
                        data.lastEpisodes.reverse().slice(0, 24).forEach(function(lastEpisode) {
                            var anime = animes[lastEpisode.id];
                            var episode = lastEpisode.number;
                            var newItem = ''
                            newItem += `<div class="item" onclick="window.location.href='?anime=${anime.id}&episode=${episode}'">`;
                            newItem += `<img src="./images/${anime.id}_HorizontalBanner.png" class="banner">`;
                            newItem += `<p class="type">${anime.type == "Anime"? `Episodio ${episode}`: anime.type}</p>`;
                            newItem += `<p class="name" title="${anime.name}">${anime.name}</p>`;
                            newItem += `</div>`;
                            $('#lastEpisode').append(newItem);
                        });
                        data.lastAnimes.reverse().slice(0, 24).forEach(function(lastAnime) {
                            var anime = animes[lastAnime.id];
                            var newItem = ''
                            newItem += `<div class="item" onclick="window.location.href='?anime=${anime.id}'">`;
                            newItem += `<img src="./images/${anime.id}_VerticalBanner.png" class="banner">`;
                            newItem += `<p class="type">${anime.type}</p>`;
                            newItem += `<p class="name" title="${anime.name}">${anime.name}</p>`;
                            newItem += `</div>`;
                            $('#lastAnimes').append(newItem);
                        });
                        data.lastFilms.reverse().slice(0, 24).forEach(function(lastFilm) {
                            var anime = animes[lastFilm.id];
                            var newItem = ''
                            newItem += `<div class="item" onclick="window.location.href='?anime=${anime.id}'">`;
                            newItem += `<img src="./images/${anime.id}_VerticalBanner.png" class="banner">`;
                            newItem += `<p class="type">${anime.type}</p>`;
                            newItem += `<p class="name" title="${anime.name}">${anime.name}</p>`;
                            newItem += `</div>`;
                            $('#lastFilms').append(newItem);
                        });
                        data.finishedAnimes.reverse().slice(0, 24).forEach(function(finishedAnime) {
                            var anime = animes[finishedAnime.id];
                            var newItem = ''
                            newItem += `<div class="item" onclick="window.location.href='?anime=${anime.id}'">`;
                            newItem += `<img src="./images/${anime.id}_VerticalBanner.png" class="banner">`;
                            newItem += `<p class="type">${anime.type}</p>`;
                            newItem += `<p class="name" title="${anime.name}">${anime.name}</p>`;
                            newItem += `</div>`;
                            $('#finishedAnimes').append(newItem);
                        });

                    });
                });
            }
        </script>
    </body>
</html>
